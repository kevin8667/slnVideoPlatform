<div class="topbar">
  <p-paginator
    [rows]="rows"
    [totalRecords]="playlists.length"
    [rowsPerPageOptions]="[1, 5, 10, 15, 20]"
    (onPageChange)="paginate($event)"
    class="topbar-paginator">
  </p-paginator>

  <div class="topbar-search">
    <p-autoComplete
        [(ngModel)]="selectedVideos"
        [suggestions]="filteredVideos"
        (completeMethod)="searchVideos($event)"
        field="videoName"
        [multiple]="true"
        placeholder="搜尋影片名稱">
    </p-autoComplete>

    <p-button (click)="searchPlaylists()" icon="pi pi-search" [rounded]="true" [text]="true"></p-button>
  </div>
</div>

<a routerLink="member">會員頁面</a>

<div class="grid-view">
  <div *ngFor="let playlist of paginatedPlaylists" class="playlist-card" [attr.data-id]="playlist.playListId" (click)="onCardClick(playlist.playListId??0)">
    <p-card
      [header]="playlist.playListName"
      [subheader]="playlist.playListDescription"
      class="custom-card-two">

      <ng-template pTemplate="content">
        <img *ngIf="playlist.showImage" [src]="'data:image/png;base64,' + playlist.showImage" alt="{{ playlist.playListName }}" class="playlist-image">
      </ng-template>

      <div class="playlist-info">
        <div class="info-row">
          <span class="info-item">
            <i class="pi pi-eye"></i> {{ playlist.viewCount }}
          </span>
          <span class="info-item" (click)="checkAndConfirmAddToFavorites($event, playlist)">
            <i class="pi pi-plus-circle"></i> {{ playlist.addedCount }}
          </span>
          <span class="info-item">
            <i class="pi pi-share-alt"></i> {{ playlist.sharedCount }}
          </span>
          <span class="info-item like-item" (click)="incrementLike(playlist); $event.stopPropagation()">
            <i class="pi pi-heart"></i> {{ playlist.likeCount }}
            <span *ngIf="playlist.showLikeEffect" class="increment-effect">+1</span>
          </span>
        </div>
      </div>
    </p-card>
  </div>
</div>

<p-confirmPopup></p-confirmPopup>
<p-toast></p-toast>

<p-dialog [(visible)]="displayModal" [modal]="true" header="播放清單內容" (onHide)="closeModal()">
  <div cdkDropList (cdkDropListDropped)="drop($event)">
    <app-playlistitem *ngFor="let item of selectedPlaylistItems; let i = index"
                      [item]="item"
                      (remove)="removeItem(item)"
                      cdkDrag>
    </app-playlistitem>
  </div>
</p-dialog>

